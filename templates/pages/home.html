{% extends "base.html" %}

{% block title %}Welcome â€” Salita{% endblock %}

{% block head %}
<script>
  // Detect if user is authenticated by checking if /stream is accessible
  async function checkAuth() {
    try {
      const res = await fetch('/stream', { redirect: 'manual' });
      // If we get a redirect to login, user is not authenticated
      // If we get OK or other response, user is authenticated
      return res.status !== 401 && res.type !== 'opaqueredirect';
    } catch {
      return false;
    }
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const isAuthenticated = await checkAuth();
    const actions = document.getElementById('hero-actions');

    if (isAuthenticated) {
      // Authenticated: show app interface
      actions.innerHTML = '<a href="/stream" class="btn btn--primary">View Stream</a>';
    } else {
      // Not authenticated: show login link
      actions.innerHTML = '<a href="/auth/login" class="btn btn--primary">Sign In</a>';
    }
  });
</script>
{% endblock %}

{% block content %}
<div class="hero">
  <h1 class="hero__title">Welcome to Salita</h1>
  <p class="hero__subtitle">
    Your personal home server. A quiet corner of the internet that belongs to you.
  </p>

  {% if user_count == 0 %}
  <div class="card setup-card">
    <h2 class="setup-card__title">First-time Setup</h2>
    <p class="setup-card__text">No accounts exist yet. Create your admin account to get started.</p>
    <a href="/auth/setup" class="btn btn--primary">Set Up Admin Account</a>
  </div>
  {% else %}
  <div class="hero__actions" id="hero-actions">
    <!-- Actions will be dynamically loaded based on auth state -->
    <a href="/stream" class="btn btn--primary">View Stream</a>
  </div>
  {% endif %}
</div>
{% endblock %}
